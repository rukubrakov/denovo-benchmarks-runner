Bootstrap: docker
From: python:3.10

%files
    # Copy algorithm-related files
    algorithms/casanovo /algo
    algorithms/base /algo/base

%post
    # Install dependencies
    # (pandas is recommended to support parsing dataset tags)
    pip install --no-cache-dir pandas
    # Install PyTorch < 2.6 to avoid weights_only compatibility issues
    pip install --no-cache-dir "torch<2.6,>=2.5"
    # Install algorithm
    pip install --no-cache-dir casanovo==5.0.0

%post
    # Make sure make_predictions.sh file is executable.
    chmod +x /algo/make_predictions.sh

# Run algorithm and convert outputs.
# Data is expected to be mounted into /algo/data dir.
%runscript
    cd /algo && ./make_predictions.sh data
